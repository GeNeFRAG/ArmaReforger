<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Arma Reforger Mortar Calculator | Fire Solution & Ballistics Tool</title>
    <meta name="title" content="Arma Reforger Mortar Calculator | Fire Solution & Ballistics Tool">
    <meta name="description" content="Free online mortar calculator for Arma Reforger. Calculate precise firing solutions with grid coordinates, elevation, azimuth, and time of flight. Supports US 60mm and Russian 82mm mortars.">
    <meta name="keywords" content="arma reforger, mortar calculator, firing solution, ballistics, grid coordinates, artillery calculator, mil system, US mortar, Russian mortar, game tool">
    <meta name="author" content="ArmaMortars.org">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://armamortars.org/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://armamortars.org/">
    <meta property="og:title" content="Arma Reforger Mortar Calculator | Fire Solution & Ballistics Tool">
    <meta property="og:description" content="Free online mortar calculator for Arma Reforger. Calculate precise firing solutions with grid coordinates, elevation, azimuth, and time of flight.">
    <meta property="og:image" content="https://armamortars.org/icon.png">
    <meta property="og:site_name" content="ArmaMortars.org">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://armamortars.org/">
    <meta name="twitter:title" content="Arma Reforger Mortar Calculator">
    <meta name="twitter:description" content="Free online mortar calculator for Arma Reforger. Calculate precise firing solutions with grid coordinates.">
    <meta name="twitter:image" content="https://armamortars.org/icon.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6b8e23">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Arma Reforger Mortar Calculator",
      "url": "https://armamortars.org/",
      "description": "Calculate precise mortar firing solutions for Arma Reforger with grid coordinates, elevation, and ballistics data",
      "applicationCategory": "GameApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "150"
      }
    }
    </script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a1f1e 0%, #2a3532 100%);
            color: #e8e8e8;
            min-height: 100vh;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #6b8e23;
        }
        .logo {
            width: 80px;
            height: auto;
            filter: brightness(0) invert(1) drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }
        h1 {
            color: #c8d4a0;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 1.8em;
        }
        h2 {
            color: #b8c7a0;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 25px;
            margin-bottom: 15px;
            border-left: 4px solid #6b8e23;
            padding-left: 12px;
        }
        .container {
            background: rgba(35, 45, 42, 0.85);
            padding: 25px;
            border-radius: 4px;
            border: 1px solid #3a4a45;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #b8c7a0;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #4a5a52;
            border-radius: 2px;
            font-size: 14px;
            background: #2a3532;
            color: #e8e8e8;
            transition: border-color 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #6b8e23;
            background: #323e3a;
        }
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        button {
            background: linear-gradient(180deg, #7a9f35 0%, #6b8e23 100%);
            color: white;
            padding: 14px 30px;
            border: 1px solid #5a7e1f;
            border-radius: 2px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        button:hover {
            background: linear-gradient(180deg, #8ab040 0%, #7a9f35 100%);
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }
        button:active {
            transform: translateY(1px);
        }
        button:disabled {
            background: #4a5550;
            border-color: #3a4540;
            cursor: not-allowed;
            opacity: 0.5;
        }
        .result {
            background: rgba(35, 45, 42, 0.9);
            padding: 20px;
            margin-top: 20px;
            border-radius: 4px;
            display: none;
            border: 1px solid #3a4a45;
        }
        .result.active {
            display: block;
        }
        .result.success {
            background: rgba(35, 45, 42, 0.85);
            border: 2px solid #6b8e23;
        }
        .result.error {
            background: rgba(35, 45, 42, 0.85);
            border: 2px solid #a85050;
        }
        .result h2 {
            margin-top: 0;
            color: #d8e4b0;
        }
        .solution-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .solution-item {
            background: rgba(20, 25, 22, 0.8);
            padding: 14px;
            border-radius: 2px;
            border: 1px solid #4a5a52;
        }
        .solution-item strong {
            display: block;
            color: #a8b898;
            font-size: 11px;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .solution-item .value {
            font-size: 22px;
            color: #e8f4d0;
            font-weight: bold;
        }
        .info {
            background: rgba(60, 80, 95, 0.3);
            border: 1px solid #4a6a75;
            padding: 12px;
            border-radius: 2px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #b8c8d0;
        }
        #loading {
            text-align: center;
            padding: 40px 20px;
            color: #95a585;
            font-size: 16px;
        }
        .toggle-container {
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(107, 142, 35, 0.1);
            border-radius: 8px;
        }
        .toggle-option {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
            flex: 1;
            text-align: center;
            white-space: nowrap;
        }
        .toggle-option.active {
            background: #6b8e23;
            border-color: #8fbc1e;
            box-shadow: 0 2px 8px rgba(107, 142, 35, 0.4);
        }
        .toggle-option:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
        }
        .coord-mode {
            display: none;
        }
        .coord-mode.active {
            display: block;
        }
        @media (max-width: 600px) {
            .row {
                grid-template-columns: 1fr;
            }
            .solution-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header class="header">
        <img src="https://vectorseek.com/wp-content/uploads/2023/07/Arma-Reforger-Logo-Vector.svg-.png" alt="Arma Reforger Logo - Mortar Calculator" class="logo">
        <h1>Mortar Fire Solution Calculator</h1>
    </header>
    
    <!-- Main Content -->
    <main>
    <div id="loading" role="status" aria-live="polite">Loading ballistic data...</div>
    
    <div id="app" style="display: none;">
        <div class="info">
            ‚ÑπÔ∏è Enter mortar and target coordinates to calculate firing solution. Charge is automatically selected for optimal range.
        </div>
        
        <div class="toggle-container">
            <span style="font-weight: 500;">Coordinate Input:</span>
            <div class="toggle-option active" onclick="setCoordMode('grid')" id="toggleGrid">
                üéØ Grid (047/069)
            </div>
            <div class="toggle-option" onclick="setCoordMode('meters')" id="toggleMeters">
                üìè Meters (X/Y)
            </div>
        </div>
        
        <div class="container">
                <h2>Mortar Position</h2>
                
                <!-- Grid Mode -->
                <div id="mortarGridMode" class="coord-mode active">
                    <div class="form-group">
                        <label for="mortarGrid">Grid Coordinates</label>
                        <input type="text" id="mortarGrid" placeholder="047/069 or 0475/0695" style="font-family: monospace; font-size: 16px;">
                        <small style="color: #999; display: block; margin-top: 5px;">3-digit (10m squares) or 4-digit (1m precision)</small>
                    </div>
                </div>
                
                <!-- Meters Mode -->
                <div id="mortarMetersMode" class="coord-mode">
                    <div class="row">
                        <div class="form-group">
                            <label for="mortarX">X Coordinate (meters)</label>
                            <input type="number" id="mortarX" value="4800" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="mortarY">Y Coordinate (meters)</label>
                            <input type="number" id="mortarY" value="7049" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="mortarZ">Elevation / Height (meters)</label>
                    <input type="number" id="mortarZ" value="168" step="0.1">
                </div>
                
                <h2>Target Position</h2>
                
                <!-- Grid Mode -->
                <div id="targetGridMode" class="coord-mode active">
                    <div class="form-group">
                        <label for="targetGrid">Grid Coordinates</label>
                        <input type="text" id="targetGrid" placeholder="085/105 or 0850/1050" style="font-family: monospace; font-size: 16px;">
                        <small style="color: #999; display: block; margin-top: 5px;">3-digit (10m squares) or 4-digit (1m precision)</small>
                    </div>
                </div>
                
                <!-- Meters Mode -->
                <div id="targetMetersMode" class="coord-mode">
                    <div class="row">
                        <div class="form-group">
                            <label for="targetX">X Coordinate (meters)</label>
                            <input type="number" id="targetX" value="4696" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="targetY">Y Coordinate (meters)</label>
                            <input type="number" id="targetY" value="5516" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="targetZ">Elevation / Height (meters)</label>
                    <input type="number" id="targetZ" value="64" step="0.1">
                </div>
                
                <div class="info" style="margin-top: 15px;">
                    üìç Distance, Bearing, and Height Difference will be computed automatically from coordinates
                </div>
            
            <h2>Weapon Configuration</h2>
            
            <div class="row">
                <div class="form-group">
                    <label for="mortarType">Mortar Type</label>
                    <select id="mortarType">
                        <!-- Populated dynamically from ballistic-data.json -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="shellType">Shell Type</label>
                    <select id="shellType">
                        <!-- Populated dynamically from ballistic-data.json -->
                    </select>
                </div>
            </div>
            
            <button id="calculate">Calculate Firing Solution</button>
        </div>
        
        <div id="output" class="result"></div>
    </div>
    </main>
    
    <!-- Footer -->
    <footer style="text-align: center; padding: 20px; margin-top: 40px; color: #95a585; font-size: 12px; border-top: 1px solid #3a4a45;">
        <p>¬© 2025 ArmaMortars.org | Free Arma Reforger Mortar Calculator</p>
        <p>Accurate ballistic calculations for US 60mm & Russian 82mm mortars | Grid coordinate support</p>
    </footer>
    
    <script src="MortarCalculator.js"></script>
    <script>
        let ballisticDataLoaded = false;
        
        // Toggle between grid and meters coordinate input
        function setCoordMode(mode) {
            const gridModes = document.querySelectorAll('#mortarGridMode, #targetGridMode');
            const meterModes = document.querySelectorAll('#mortarMetersMode, #targetMetersMode');
            const toggleGrid = document.getElementById('toggleGrid');
            const toggleMeters = document.getElementById('toggleMeters');
            
            if (mode === 'grid') {
                gridModes.forEach(el => el.classList.add('active'));
                meterModes.forEach(el => el.classList.remove('active'));
                toggleGrid.classList.add('active');
                toggleMeters.classList.remove('active');
            } else {
                gridModes.forEach(el => el.classList.remove('active'));
                meterModes.forEach(el => el.classList.add('active'));
                toggleGrid.classList.remove('active');
                toggleMeters.classList.add('active');
            }
        }
        
        // Get all available mortar types from loaded ballistic data
        function getAllMortarTypes() {
            try {
                return MortarCalculator.getAllMortarTypes();
            } catch (error) {
                console.warn('Could not get mortar types:', error);
                return [];
            }
        }
        
        // Get available shell types for a mortar from loaded ballistic data
        function getShellTypesForMortar(mortarId) {
            try {
                const config = MortarCalculator.getWeaponConfig(mortarId, 'HE');
                const mortar = config.mortar;
                
                return mortar.shellTypes.map(shell => ({
                    value: shell.type,
                    label: shell.name
                }));
            } catch (error) {
                console.warn('Could not get shell types:', error);
                return [];
            }
        }
        
        // Update mortar type options from ballistic data
        function updateMortarTypes() {
            const mortarTypeSelect = document.getElementById('mortarType');
            const currentValue = mortarTypeSelect.value;
            
            const availableMortars = getAllMortarTypes();
            
            // Sort: US mortars first, then others
            availableMortars.sort((a, b) => {
                const aIsUS = a.id === 'US' || a.id.startsWith('US_');
                const bIsUS = b.id === 'US' || b.id.startsWith('US_');
                if (aIsUS && !bIsUS) return -1;
                if (!aIsUS && bIsUS) return 1;
                return a.name.localeCompare(b.name);
            });
            
            mortarTypeSelect.innerHTML = '';
            availableMortars.forEach(mortar => {
                const option = document.createElement('option');
                option.value = mortar.id;
                option.textContent = `${mortar.name}`;
                mortarTypeSelect.appendChild(option);
            });
            
            // Restore previous selection if available, otherwise select US mortar
            const optionExists = availableMortars.some(m => m.id === currentValue);
            if (optionExists) {
                mortarTypeSelect.value = currentValue;
            } else if (availableMortars.length > 0) {
                const usMortar = availableMortars.find(m => m.id === 'US' || m.id.startsWith('US_'));
                mortarTypeSelect.value = usMortar ? usMortar.id : availableMortars[0].id;
            }
        }
        
        // Update shell type options based on mortar type
        function updateShellTypes() {
            const mortarType = document.getElementById('mortarType').value;
            const shellTypeSelect = document.getElementById('shellType');
            const currentValue = shellTypeSelect.value;
            
            const availableShells = getShellTypesForMortar(mortarType);
            
            shellTypeSelect.innerHTML = '';
            availableShells.forEach(shell => {
                const option = document.createElement('option');
                option.value = shell.value;
                option.textContent = shell.label;
                shellTypeSelect.appendChild(option);
            });
            
            // Restore previous selection if available, otherwise select first
            const optionExists = availableShells.some(s => s.value === currentValue);
            if (optionExists) {
                shellTypeSelect.value = currentValue;
            } else if (availableShells.length > 0) {
                shellTypeSelect.value = availableShells[0].value;
            }
        }
        
        // Load ballistic data on page load
        async function init() {
            const loading = document.getElementById('loading');
            const app = document.getElementById('app');
            
            try {
                await MortarCalculator.loadBallisticData('ballistic-data.json');
                ballisticDataLoaded = true;
                
                loading.style.display = 'none';
                app.style.display = 'block';
                
                // Initialize mortar types and shell types after data is loaded
                updateMortarTypes();
                updateShellTypes();
                
                console.log('‚úÖ Ballistic data loaded successfully');
            } catch (error) {
                loading.innerHTML = `
                    <div style="color: red;">
                        ‚ùå Error loading ballistic data: ${error.message}
                        <br>Make sure the HTTP server is running from the mortar_core directory.
                    </div>
                `;
                console.error('Error loading ballistic data:', error);
            }
        }
        
        // Setup event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const calculateBtn = document.getElementById('calculate');
            const mortarTypeSelect = document.getElementById('mortarType');
            
            // Update shell types when mortar type changes
            mortarTypeSelect.addEventListener('change', updateShellTypes);
            
            calculateBtn.addEventListener('click', calculateSolution);
            
            // Allow Enter key to trigger calculation
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') calculateSolution();
                });
            });
        });
        
        function calculateSolution() {
            if (!ballisticDataLoaded) {
                alert('Ballistic data not loaded yet. Please wait...');
                return;
            }
            
            const output = document.getElementById('output');
            
            // Clear previous results
            output.className = 'result';
            output.innerHTML = '';
            
            try {
                const mortarId = document.getElementById('mortarType').value;
                const shellType = document.getElementById('shellType').value;
                
                // Parse mortar position
                let mortarPos;
                const mortarGrid = document.getElementById('mortarGrid').value.trim();
                if (mortarGrid) {
                    const mortarZ = parseFloat(document.getElementById('mortarZ').value) || 0;
                    mortarPos = { grid: mortarGrid, z: mortarZ };
                } else {
                    const mortarX = parseFloat(document.getElementById('mortarX').value);
                    const mortarY = parseFloat(document.getElementById('mortarY').value);
                    const mortarZ = parseFloat(document.getElementById('mortarZ').value) || 0;
                    if (isNaN(mortarX) || isNaN(mortarY)) {
                        throw new Error('Enter either grid coordinates or X/Y meter values for mortar');
                    }
                    mortarPos = { x: mortarX, y: mortarY, z: mortarZ };
                }
                
                // Parse target position
                let targetPos;
                const targetGrid = document.getElementById('targetGrid').value.trim();
                if (targetGrid) {
                    const targetZ = parseFloat(document.getElementById('targetZ').value) || 0;
                    targetPos = { grid: targetGrid, z: targetZ };
                } else {
                    const targetX = parseFloat(document.getElementById('targetX').value);
                    const targetY = parseFloat(document.getElementById('targetY').value);
                    const targetZ = parseFloat(document.getElementById('targetZ').value) || 0;
                    if (isNaN(targetX) || isNaN(targetY)) {
                        throw new Error('Enter either grid coordinates or X/Y meter values for target');
                    }
                    targetPos = { x: targetX, y: targetY, z: targetZ };
                }
                
                // Use prepareInput to calculate distance, bearing, and height difference
                const input = MortarCalculator.prepareInput(mortarPos, targetPos, mortarId, shellType);
                
                console.log('Mortar Position:', mortarPos);
                console.log('Target Position:', targetPos);
                console.log('Calculated Parameters:', {
                    distance: input.distance.toFixed(1) + 'm',
                    bearing: input.bearing.toFixed(1) + '¬∞',
                    bearingMils: MortarCalculator.degreesToMils(input.bearing) + ' mils',
                    heightDifference: input.heightDifference.toFixed(1) + 'm'
                });
                
                console.log('Input:', input);
                
                // Calculate all trajectory options
                const solutions = MortarCalculator.calculateAllTrajectories(input);
                
                console.log('Solutions:', solutions);
                
                // Generate trajectory data using MortarCalculator
                const trajectoryData = MortarCalculator.generateTrajectoryPoints(solutions, input.distance, input.mortarType);
                
                // Render SVG trajectories
                let trajectorySVG = '';
                if (trajectoryData.series && trajectoryData.series.length > 0) {
                    const svgTop = 30;
                    const groundY = 220;
                    const availablePx = groundY - svgTop;
                    const verticalScale = trajectoryData.globalMaxY > 0 ? availablePx / trajectoryData.globalMaxY : 1;
                    
                    trajectoryData.series.forEach((series, i) => {
                        const { color, elevDeg, points, charge, tof } = series;
                        
                        let svgPoints = points.map(p => {
                            const screenX = 50 + (p.x / trajectoryData.globalRange) * 500;
                            const screenY = groundY - p.y * verticalScale;
                            return screenX.toFixed(1) + ',' + screenY.toFixed(1);
                        });
                        
                        svgPoints[svgPoints.length - 1] = '550,' + groundY;
                        
                        const pathData = 'M ' + svgPoints.join(' L ');
                        const legendY = 30 + i * 25;
                        const textY = 34 + i * 25;
                        
                        trajectorySVG += '<path d="' + pathData + '" fill="none" stroke="' + color + '" stroke-width="2.5" opacity="0.8"/>';
                        trajectorySVG += '<circle cx="300" cy="' + legendY + '" r="4" fill="' + color + '"/>';
                        trajectorySVG += '<text x="310" y="' + textY + '" font-size="11" fill="' + color + '" font-weight="bold">';
                        trajectorySVG += 'Charge ' + charge + ': ' + elevDeg.toFixed(1) + '¬∞ (' + tof + 's)</text>';
                    });
                }
                
                // Display result
                output.className = 'result active';
                
                if (solutions.length > 0 && solutions[0].inRange) {
                    output.classList.add('success');
                    
                    let solutionsHTML = '';
                    
                    solutions.forEach((solution, index) => {
                        let trajectoryLabel;
                        if (index === 0) {
                            trajectoryLabel = 'üéØ Optimal Fire Solution';
                        } else {
                            trajectoryLabel = solution.trajectoryType === 'high' 
                                ? 'üîÑ Alternative Fire Solution (High Angle)' 
                                : 'üîÑ Alternative Fire Solution (Low Angle)';
                        }
                        
                        let chargeDesc = '';
                        if (index === 0) {
                            chargeDesc = solutions.length > 1 
                                ? `Fastest - ${solution.timeOfFlight}s flight time`
                                : 'Optimal solution';
                        } else {
                            const timeDiff = solution.timeOfFlight - solutions[0].timeOfFlight;
                            const elevDiff = solution.elevation - solutions[0].elevation;
                            const elevDegDiff = MortarCalculator.milsToDegrees(solution.elevation, input.mortarType) - MortarCalculator.milsToDegrees(solutions[0].elevation, input.mortarType);
                            const elevSign = elevDiff > 0 ? '+' : '';
                            chargeDesc = `+${timeDiff.toFixed(1)}s slower, ${elevSign}${elevDiff} mils (${elevSign}${elevDegDiff.toFixed(1)}¬∞) vs charge ${solutions[0].charge}`;
                        }
                        
                        solutionsHTML += `
                            <div style="background: ${index === 0 ? 'rgba(40, 55, 45, 0.9)' : 'rgba(35, 45, 42, 0.7)'}; padding: 15px; border-radius: 4px; margin-bottom: 10px; border: ${index === 0 ? '2px solid #6b8e23' : '1px solid #4a5a52'};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h3 style="margin: 0; font-size: 16px; color: ${index === 0 ? '#c8d4a0' : '#a8b898'};">
                                        ${trajectoryLabel} - Charge ${solution.charge}
                                    </h3>
                                    <span style="font-size: 12px; color: #95a585; font-style: italic;">
                                        ${chargeDesc}
                                    </span>
                                </div>
                                <div class="solution-grid">
                                    <div class="solution-item">
                                        <strong>CHARGE</strong>
                                        <div class="value">${solution.charge}</div>
                                    </div>
                                    <div class="solution-item">
                                        <strong>ELEVATION</strong>
                                        <div class="value">${solution.elevation} mils</div>
                                        <div style="color: #95a585; font-size: 12px;">(${MortarCalculator.milsToDegrees(solution.elevation, input.mortarType).toFixed(1)}¬∞)</div>
                                    </div>
                                    <div class="solution-item">
                                        <strong>AZIMUTH</strong>
                                        <div class="value">${solution.azimuthMils} mils</div>
                                        <div style="color: #95a585; font-size: 12px;">(${solution.azimuth.toFixed(1)}¬∞)</div>
                                    </div>
                                    <div class="solution-item">
                                        <strong>TIME OF FLIGHT</strong>
                                        <div class="value">${solution.timeOfFlight}s</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; padding: 8px; background: rgba(20, 25, 22, 0.6); border-radius: 3px; font-size: 12px; color: #a8b898;">
                                    Range: ${solution.minRange}m - ${solution.maxRange}m
                                </div>
                            </div>
                        `;
                    });
                    
                    output.innerHTML = `
                        <h2>‚úÖ Firing Solution${solutions.length > 1 ? 's' : ''} Found</h2>
                        
                        <div style="background: rgba(60, 75, 50, 0.4); padding: 12px; border-radius: 4px; border: 1px solid #6b8e23; margin-bottom: 15px; color: #d8e4b0;">
                            <strong>üìê Mil System:</strong> ${MortarCalculator.getMilSystemName(input.mortarType)}
                        </div>
                        
                        <div style="background: rgba(35, 45, 42, 0.85); padding: 15px; border-radius: 4px; margin-bottom: 15px; border: 1px solid #3a4a45;">
                            <h3 style="margin-top: 0; font-size: 16px; color: #d8e4b0;">üìç Target Analysis</h3>
                            <div class="solution-grid">
                                <div class="solution-item">
                                    <strong>DISTANCE</strong>
                                    <div class="value">${input.distance.toFixed(1)}m</div>
                                </div>
                                <div class="solution-item">
                                    <strong>BEARING</strong>
                                    <div class="value">${solutions[0].azimuthMils} mils</div>
                                    <div style="color: #95a585; font-size: 12px;">(${input.bearing.toFixed(1)}¬∞)</div>
                                </div>
                                <div class="solution-item">
                                    <strong>HEIGHT DIFF</strong>
                                    <div class="value">${input.heightDifference > 0 ? '+' : ''}${input.heightDifference.toFixed(1)}m</div>
                                    <div style="color: #95a585; font-size: 12px;">${input.heightDifference > 0 ? 'Target higher' : input.heightDifference < 0 ? 'Target lower' : 'Same level'}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${solutions.length > 1 ? '<div style="background: rgba(60, 75, 50, 0.4); padding: 12px; border-radius: 4px; border: 1px solid #6b8e23; margin-bottom: 15px; color: #d8e4b0;"><strong>üí° Multiple Charge Options Available:</strong><br><small>Lower charges are more accurate but have limited range. Higher charges reach further but are less precise. High angle trajectories can clear obstacles.</small></div>' : ''}
                        
                        <h3 style="font-size: 16px; margin-bottom: 10px;">Fire Solutions (${solutions.length})</h3>
                        ${solutionsHTML}
                        
                        ${solutions.length > 1 ? `
                        <div style="background: rgba(35, 45, 42, 0.85); padding: 15px; border-radius: 4px; margin-top: 20px; margin-bottom: 15px; border: 1px solid #3a4a45;">
                            <h3 style="margin-top: 0; font-size: 16px; color: #d8e4b0;">üìä Trajectory Comparison</h3>
                            <svg width="100%" height="250" viewBox="0 0 600 250" style="background: #1a2422; border-radius: 4px;">
                                <!-- Ground and labels -->
                                <line x1="50" y1="220" x2="550" y2="220" stroke="#6b8e23" stroke-width="2"/>
                                <text x="50" y="240" text-anchor="middle" font-size="11" fill="#95a585">0m</text>
                                <text x="300" y="240" text-anchor="middle" font-size="11" fill="#95a585">${(input.distance/2).toFixed(0)}m</text>
                                <text x="550" y="240" text-anchor="middle" font-size="11" fill="#95a585">${input.distance.toFixed(0)}m</text>
                                
                                <!-- Mortar marker -->
                                <circle cx="50" cy="220" r="4" fill="#6b8e23"/>
                                <text x="50" y="210" text-anchor="middle" font-size="10" fill="#c8d4a0" font-weight="bold">M</text>
                                
                                ${trajectorySVG}
                            </svg>
                        </div>
                        ` : ''}
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(60, 75, 50, 0.4); border-radius: 4px; border: 1px solid #6b8e23; color: #d8e4b0;">
                            <strong>üéØ Recommended Fire Mission</strong><br>
                            <small>Charge ${solutions[0].charge} | Elevation ${solutions[0].elevation} mils | Azimuth ${solutions[0].azimuthMils} mils | TOF ${solutions[0].timeOfFlight}s</small>
                        </div>
                    `;
                } else {
                    const solution = solutions[0];
                    output.classList.add('error');
                    output.innerHTML = `
                        <h2>‚ùå Target Out of Range</h2>
                        <p><strong>Error:</strong> ${solution.error}</p>
                        ${solution.minRange && solution.maxRange ? `
                            <p>
                                <strong>Valid range for this configuration:</strong><br>
                                ${solution.minRange}m - ${solution.maxRange}m
                            </p>
                        ` : ''}
                        <p style="margin-top: 15px;">
                            <strong>Suggestions:</strong>
                        </p>
                        <ul>
                            <li>Try a different mortar type or shell type</li>
                            <li>Move mortar or target positions closer/further</li>
                        </ul>
                    `;
                }
            } catch (error) {
                output.className = 'result active error';
                output.innerHTML = `
                    <h2>‚ùå Calculation Error</h2>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check your input values and try again.</p>
                `;
                console.error('Calculation error:', error);
            }
        }
        
        // Initialize on page load
        init();
    </script>
</body>
</html>
